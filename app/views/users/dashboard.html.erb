<!-- master container -->
<div id='dynamic-dash-container'>
  <!-- left-bar container -->
  <div id='left-bar' class='gray-shadow fade-in-fast'>
    <!-- profile section -->
    <div id='side-profile'>
      <%= image_tag 'tony.jpg', class:'avatar-huge' %>
      <h2><%= current_user.first_name.capitalize %></h2>
      <!-- balances container -->
      <div class='gray-shadow'>
        <div class='d-flex justify-content-between'>
          <span style='color:gray;'>Available Balance:</span>
          <span>$100</span>
        </div>
        <div class='d-flex justify-content-between'>
          <span style='color:gray;'>Total Balance:</span>
          <span>$200</span>
        </div>
        <!-- transaction buttons -->
        <div class='transaction-buttons'>
          <button type="button" class="btn" data-toggle="modal" data-target="#withdrawMoney" style='margin-left:-20px;'>Withdraw</button>
          <button type="button" class="btn" data-toggle="modal" data-target="#depositMoney" style='margin-right:-20px'>Deposit</button>
        </div>
      </div>
    </div>

    <!-- watchlist container -->
    <div id='watch-list' class='gray-shadow'>
      <div id='watch-list-header'>
        <h2>Watch List</h2>
        <i class="fas fa-plus"></i>
      </div>
      <!-- watch tabs -->
      <div class='watch-tabs'>
        <h3>APPL</h3>
        <h3 style='color:#219974;'>+2.03%</h3>
      </div>
      <div class='watch-tabs'>
        <h3>TSLA</h3>
        <h3 style='color:#ad512f;'>-4.33%</h3>
      </div>
      <div class='watch-tabs'>
        <h3>BYND</h3>
        <h3 style='color:#219974;'>+5.29%</h3>
      </div>
      <div class='watch-tabs'>
        <h3>FB</h3>
        <h3 style='color:#219974;'>+2.1%</h3>
      </div>
      <div class='watch-tabs'>
        <h3>GE</h3>
        <h3 style='color:#219974;'>-2.23%</h3>
      </div>
      <div class='watch-tabs'>
        <h3>BABA</h3>
        <h3 style='color:#219974;'>+1.45%</h3>
      </div>
    </div>
  </div>

  <!-- group view contaier -->
  <div id='group-view-container'>
    <div style='height:90vh;' class='d-flex flex-column justify-content-center align-items-center fade-in'>
      <h1 class='fade-in' style='font-size:32px;'><span style='font-size:30px; color:#8B81D2;'>Welcome</span> <%= current_user.first_name %>!</h1>
      <h2 class='fade-in' style='font-size:30px;'>Click on a <span style='font-size:30px; color:#8B81D2;'>group</span> to begin.</h2>
      <i class="fas fa-arrow-circle-right fade-in" style='font-size:30px;'></i>
    </div>
  </div>

  <!-- right container -->
  <div id='right-bar' class='gray-shadow fade-in-fast'>
    <!-- groups list section -->
    <div id='side-group'>
      <div id='group-header'>
        <h2>Groups</h2>
        <div class="dropdown">
          <button class="dropdown-toggle" type="button" id="groupAction" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-users"></i>
          </button>
          <div class="dropdown-menu" aria-labelledby="groupAction">
            <a class="dropdown-item" data-toggle="modal" data-target="#createGroup" data-whatever="@createGroup">Create a group</a>
            <%= link_to "Join a group", groups_path, class:'dropdown-item' %>
          </div>
        </div>
      </div>

      <div id='groups-list'>
        <% @groups.each do |group| %>
          <div class='group-tabs-container' data-group_id='<%= group.id %>'>
            <%= link_to group_path(group), class:'group-link', method: :get, remote: true do %>
              <div class='group-tabs d-flex align-items-center' data-tab_id='1' data-group_name='<%= group.name %>' data-toggle="collapse" href="#collapse<%= group.name %>" role="button" aria-expanded="false" aria-controls="collapseExample">
                <h2><%= group.name.capitalize %></h2>
              </div>
            <% end %>
            <div class="collapse" id="collapse<%= group.name %>">
              <%= image_tag 'monsters/6.png' %>
              <div id="members-list">
                <% group.users.each do |user| %>
                  <div class='member-tabs'>
                    <div class='d-flex justify-content-start align-items-center'>
                      <%= image_tag 'tony.jpg', class:'avatar' %>
                      <h3><%= user.first_name.capitalize %></h3>
                    </div>
                    <h3>100%</h3>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<%= render 'shared/modal_create_group' %>
<%= render 'shared/modal_user_deposit' %>
<%= render 'shared/modal_user_withdraw' %>

<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

<script>
  const groups = document.getElementById('groups-list');
  const groupTabs = document.querySelectorAll('.group-tabs-container');

  // window.addEventListener('load', (e) => {
  //   groups.firstElementChild.getElementsByClassName('collapse')[0].classList.add('show');
  // })

  groupTabs.forEach((group) => {
    group.addEventListener('click', (e) => {
      const tab = e.currentTarget
      if (tab === groups.firstElementChild) {
        console.log('this is already the first child');
        groups.firstElementChild.classList.add('active');
        groups.firstElementChild.getElementsByClassName('collapse')[0].classList.toggle('show');
        // groups.firstElementChild.getElementsByClassName('group-link')[0].toggleAttribute('href');
      } else {
        // groups.firstElementChild.getElementsByClassName('group-link')[0].toggleAttribute('href');
        groups.firstElementChild.classList.remove('active');
        groups.firstElementChild.getElementsByClassName('collapse')[0].classList.remove('show');
        groups.insertAdjacentElement('afterbegin', tab);
        groups.firstElementChild.classList.add('active');
        groups.firstElementChild.getElementsByClassName('collapse')[0].classList.add('show');
      };
    });
  })
</script>
